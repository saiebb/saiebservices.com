<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Google Customer Reviews</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .console-log { 
            background: #f8f9fa; 
            border: 1px solid #dee2e6; 
            border-radius: 5px; 
            padding: 10px; 
            margin: 10px 0; 
            font-family: monospace; 
            max-height: 300px; 
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <div class="row">
            <div class="col-md-8 mx-auto">
                <div class="card">
                    <div class="card-header">
                        <h4>Ø§Ø®ØªØ¨Ø§Ø± Google Customer Reviews</h4>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <strong>ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:</strong>
                            <ol>
                                <li>Ø§Ù…Ù„Ø£ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø£Ø¯Ù†Ø§Ù‡</li>
                                <li>ÙØ¹Ù‘Ù„ Ø®ÙŠØ§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Google Reviews</li>
                                <li>Ø§Ø¶ØºØ· "Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨"</li>
                                <li>Ø±Ø§Ù‚Ø¨ Ø³Ø¬Ù„ ÙˆØ­Ø¯Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø£Ø¯Ù†Ø§Ù‡</li>
                            </ol>
                        </div>

                        <form id="testForm">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group mb-3">
                                        <label>Ø§Ù„Ø§Ø³Ù…:</label>
                                        <input type="text" id="test_name" class="form-control" value="Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group mb-3">
                                        <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</label>
                                        <input type="email" id="test_email" class="form-control" value="ahmed@example.com" required>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="test_google_consent" value="1">
                                    <label class="form-check-label" for="test_google_consent">
                                        <strong>Ø£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ù…Ø´Ø§Ø±ÙƒØ© ØªØ¬Ø±Ø¨ØªÙŠ Ù…Ø¹ Ø®Ø¯Ù…Ø§Øª ØµÙŠØ¨ Ø¹Ø¨Ø± Ø¢Ø±Ø§Ø¡ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙÙŠ Google</strong>
                                    </label>
                                </div>
                            </div>

                            <div class="text-center">
                                <button type="submit" class="btn btn-primary btn-lg">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
                                <button type="button" id="clearLog" class="btn btn-secondary btn-sm">Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„</button>
                            </div>
                        </form>

                        <div class="mt-4">
                            <h5>Ø³Ø¬Ù„ ÙˆØ­Ø¯Ø© Ø§Ù„ØªØ­ÙƒÙ…:</h5>
                            <div id="consoleLog" class="console-log"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ¬ÙŠÙ‡ console.log Ù„Ø¹Ø±Ø¶Ù‡ ÙÙŠ Ø§Ù„ØµÙØ­Ø©
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        function addToLog(message, type = 'log') {
            const logDiv = document.getElementById('consoleLog');
            const timestamp = new Date().toLocaleTimeString('ar-SA');
            const color = type === 'error' ? 'text-danger' : type === 'warn' ? 'text-warning' : 'text-dark';
            logDiv.innerHTML += `<div class="${color}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToLog(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToLog('âŒ ' + args.join(' '), 'error');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addToLog('âš ï¸ ' + args.join(' '), 'warn');
        };

        document.addEventListener('DOMContentLoaded', function() {
            console.log('âœ“ ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø¨Ù†Ø¬Ø§Ø­');
            
            // ØªØ­Ù…ÙŠÙ„ Google API
            loadGoogleAPI();
            
            document.getElementById('testForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                console.log('ğŸ“ Ø¨Ø¯Ø¡ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬...');
                
                const formData = {
                    name: document.getElementById('test_name').value,
                    email: document.getElementById('test_email').value,
                    google_consent: document.getElementById('test_google_consent').checked
                };
                
                console.log('ğŸ“Š Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ù…ÙˆØ°Ø¬:', JSON.stringify(formData));
                
                if (formData.google_consent) {
                    console.log('âœ… Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Google Reviews - Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬...');
                    setTimeout(() => {
                        showGoogleCustomerReviews(formData);
                    }, 1500);
                } else {
                    console.log('âŒ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù„Ù… ÙŠÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Google Reviews');
                }
            });
            
            document.getElementById('clearLog').addEventListener('click', function() {
                document.getElementById('consoleLog').innerHTML = '';
            });
        });

        // ØªØ­Ù…ÙŠÙ„ Google API
        function loadGoogleAPI() {
            console.log('ğŸ”„ Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Google API...');
            
            if (typeof gapi === 'undefined') {
                const script = document.createElement('script');
                script.src = 'https://apis.google.com/js/platform.js?onload=initGoogleAPI';
                script.async = true;
                script.defer = true;
                script.onload = function() {
                    console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Google API Ø¨Ù†Ø¬Ø§Ø­');
                };
                script.onerror = function() {
                    console.error('âŒ ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Google API');
                };
                document.head.appendChild(script);
            } else {
                console.log('âœ… Google API Ù…Ø­Ù…Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹');
                initGoogleAPI();
            }
        }

        // ØªÙ‡ÙŠØ¦Ø© Google API
        function initGoogleAPI() {
            console.log('ğŸ”§ ØªÙ‡ÙŠØ¦Ø© Google API...');
            
            if (typeof gapi !== 'undefined') {
                gapi.load('surveyoptin', function() {
                    console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Google Customer Reviews API Ø¨Ù†Ø¬Ø§Ø­');
                });
            } else {
                console.error('âŒ Google API ØºÙŠØ± Ù…ØªÙˆÙØ±');
            }
        }

        // Ø¹Ø±Ø¶ Google Customer Reviews
        function showGoogleCustomerReviews(customerData) {
            console.log('ğŸ¯ Ù…Ø­Ø§ÙˆÙ„Ø© Ø¹Ø±Ø¶ Google Customer Reviews...');
            
            if (typeof gapi !== 'undefined' && gapi.surveyoptin) {
                try {
                    const orderId = 'SAIEB-TEST-' + Date.now() + '-' + Math.random().toString(36).substr(2, 6).toUpperCase();
                    
                    const estimatedDelivery = new Date();
                    estimatedDelivery.setDate(estimatedDelivery.getDate() + 7);
                    const deliveryDate = estimatedDelivery.toISOString().split('T')[0];
                    
                    console.log('ğŸ“‹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨:', JSON.stringify({
                        orderId: orderId,
                        email: customerData.email,
                        deliveryDate: deliveryDate
                    }));
                    
                    gapi.surveyoptin.render({
                        "merchant_id": 5349752399,
                        "order_id": orderId,
                        "email": customerData.email,
                        "delivery_country": "SA",
                        "estimated_delivery_date": deliveryDate,
                        // Ø¥Ø²Ø§Ù„Ø© products Ù„ØªØ¬Ù†Ø¨ Ù…Ø´Ø§ÙƒÙ„ GTIN
                        // "products": [{
                        //     "gtin": "SAIEB_SERVICE_TEST_123"
                        // }],
                        "opt_in_style": "OPT_IN_STYLE_CENTER_DIALOG"
                    });
                    
                    console.log('âœ… ØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Google Customer Reviews Ù„Ù„Ø¹Ù…ÙŠÙ„: ' + customerData.name);
                    
                } catch (error) {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Google Customer Reviews:', error.message);
                }
            } else {
                console.warn('âš ï¸ Google API ØºÙŠØ± Ø¬Ø§Ù‡Ø² - Ù…Ø­Ø§ÙˆÙ„Ø© Ø£Ø®Ø±Ù‰ Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØ© ÙˆØ§Ø­Ø¯Ø©...');
                setTimeout(() => showGoogleCustomerReviews(customerData), 1000);
            }
        }
    </script>
</body>
</html>